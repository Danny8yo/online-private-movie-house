------

# 术语表 (Glossary)

| 术语 (Term)                            | 定义 (Definition)                                            |
| :------------------------------------- | :----------------------------------------------------------- |
| **观影室 (Viewing Room)**              | 系统中的一个虚拟空间实体，允许多个用户在其中共同观看媒体内容。每个房间拥有独立的状态（播放进度、成员列表、配置信息）。 |
| **房间基础结构 (Room Infrastructure)** | 创建房间时系统初始化的一组最小数据集，包括唯一的房间ID、默认配置（如最大人数）及所有者关联信息。 |
| **加入条件 (Join Requirement)**        | 系统用于决定用户能否进入观影室的规则集合（如：房间未满、密码正确）。 |
| **可加入状态 (Joinable State)**        | 房间的一种生命周期状态。若房间已解散或被系统锁定，则处于不可加入状态。 |
| **加入凭据 (Join Token)**              | 私密房间要求用户提供的验证信息（通常为房间密码或邀请码）。   |
| **同步观看 (Synchronized Viewing)**    | 系统的核心能力。指系统将新加入用户的播放器状态（进度、倍速、源）强制调整为与**房间状态对象**一致的过程。 |
| **房主 (Room Owner)**                  | 房间的创建者，拥有该房间的最高管理权限（如解散房间）。       |

---

# 用例描述：创建观影室

## 1. 用例名称
**创建观影室**
**ID**: UC-U02

## 2. 简要描述
本用例描述了用户如何请求系统生成一个新的观影室。系统在验证请求有效后，实例化一个新的房间对象，并将发起用户指定为该房间的**房主**。

## 3. 参与者
- **发起参与者**：用户 (User)

## 4. 前置条件
- 用户已登录系统。
- 用户未达到创建房间的数量上限（若有）。

## 5. 基本事件流
1. **用例启动**：用户向系统提交创建新观影室的请求，并提供初始配置参数（如房间名称、是否公开）。
2. **验证请求**：系统确认用户的请求参数格式正确，且符合业务规则（如房间名未包含敏感词）。
3. **生成房间**：系统在数据库中创建一个新的观影室实例，生成唯一的房间标识符，并初始化房间状态。
4. **分配权限**：系统将当前用户记录为该新房间的**房主**。
5. **初始化状态**：系统将房间标记为“可加入状态”。
6. **反馈结果**：系统向用户返回创建成功的确认信息及新房间的访问入口。
7. **用例结束**。

## 6. 备选事件流 

### A1. 创建受限
* **触发条件**：在基本流步骤 2，系统检测到用户已达到最大持有的房间数量限制。
1. 系统拒绝创建请求。
2. 系统向用户显示“创建数量已达上限”的提示。
3. 用例结束。

### A2. 系统资源不足
* **触发条件**：在基本流步骤 3，系统因负载过高或存储不足无法分配新房间。
1. 系统记录错误日志。
2. 系统向用户提示“服务暂时不可用，请稍后重试”。
3. 用例结束。

## 7. 后置条件
- **成功**：系统中新增了一个关联到该用户的观影室记录；用户拥有该房间的最高权限。
- **失败**：系统状态无变化。

---

# 用例描述：加入观影室

## 1. 用例名称
**加入观影室**
**ID**: UC-U01

## 2. 简要描述
本用例描述了用户如何尝试进入一个已存在的观影室。系统验证房间状态及用户的加入资格（如密码），并在验证通过后，将用户的播放状态与房间内其他成员进行**初始同步**。

## 3. 参与者
- **发起参与者**：用户 

## 4. 前置条件
- 用户已登录。
- 用户已知晓目标房间的标识符（ID或房间号）。

## 5. 基本事件流 
1. **用例启动**：用户向系统发起加入指定观影室的请求。
2. **验证房间状态**：
   - 系统检索目标房间信息。
   - **执行子流 S1：验证加入条件**。
3. **执行加入**：系统将用户添加到该房间的“在线成员列表”中。
4. **初始同步**：
   - 系统获取房间当前的播放状态（视频源、进度、倍速）。
   - 系统将该状态发送给用户客户端，强制用户端播放器与房间保持一致。
5. **广播通知**：系统向房间内现有的其他成员广播“新用户加入”的系统消息。
6. **用例结束**。

## 6. 备选事件流 

### A1. 房间不存在
* **触发条件**：在基本流步骤 2，系统无法找到指定 ID 的房间。
1. 系统向用户提示“房间不存在”。
2. 用例结束。

### A2. 房间不可加入
* **触发条件**：在子流 S1 中，房间已满员或被锁定。
1. 系统拒绝加入请求。
2. 系统向用户显示具体原因（如“房间人数已满”）。
3. 用例结束。

### A3. 凭据验证失败
* **触发条件**：在子流 S1 中，用户提供的**加入凭据**（密码）错误。
1. 系统提示“密码错误”。
2. 系统允许用户重新输入凭据（返回子流 S1）。

## 7. 子流

### S1. 验证加入条件
1. 系统检查房间是否处于“可加入状态”（未解散、未被系统封禁）。
2. 系统检查房间当前人数是否已达上限。
3. **IF** 房间设置了访问密码（私密房间）：
   - 系统验证用户提供的**加入凭据**是否与房间设置匹配。
4. **结果**：若任一检查失败，触发相应的备选流（A2 或 A3）；若全部通过，返回基本流。

## 8. 后置条件
- **成功**：用户与房间建立了活跃连接；用户的播放状态与房间同步。
- **失败**：用户未能进入房间，且未获取房间内的任何信息。
