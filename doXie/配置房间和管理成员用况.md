# 用例描述：配置房间

## 1. 简要描述
本用例描述了**房主**如何通过系统对房间的属性（如人数限制、访问密码）、成员权限进行调整，或执行解散房间等高危操作。该用例确保了房主对房间资产和秩序拥有最高控制权。

## 2. 参与者
- **发起参与者**：房主

## 3. 前置条件
- 房主已登录系统。
- 目标房间处于活跃状态。

## 4. 基本事件流 
*(场景：房主修改房间的最大人数限制和公开状态)*

1. **用例启动**：房主请求对房间进行配置管理，用例启动。
2. **展示信息**：系统检索并显示当前房间的配置信息（包括最大人数、公开状态、管理员列表）。
3. **选择操作**：房主选择修改房间的基本信息。
4. **输入参数**：房主提供新的最大人数数值或修改公开性设置。
5. **业务规则校验**：
   - 系统验证输入人数是否在允许范围内（如 2-50 人）。
   - 系统验证新人数是否低于当前在线人数（若低于则不允许修改）。
6. **保存配置**：系统更新房间的元数据信息。
7. **反馈结果**：系统向房主确认配置已更新，并向房间内所有成员广播配置变更通知（如“房间人数上限已调整”）。
8. **用例结束**。

## 5. 备选事件流 

### A1. 管理员权限变更 
* **触发条件**：在基本流步骤 3，房主选择“管理管理员”。
1. 系统显示当前的成员列表及身份标识。
2. 房主选择一名成员并指定操作（提拔为管理员 / 取消管理员）。
3. 系统验证操作合法性（例如：不能取消自己的房主身份）。
4. 系统更新该成员在数据库中的权限状态。
5. 系统向相关成员发送权限变更通知。
6. 流程返回基本流步骤 2（房主可继续进行其他配置）。

### A2. 解散房间
* **触发条件**：在基本流步骤 3，房主选择“解散房间”。
1. 系统显示解散后果警告（“操作不可恢复，所有数据将被清除”）。
2. 房主确认解散操作。
3. 系统强制断开房间内所有用户的连接。
4. 系统从数据库中物理删除房间记录及关联数据。
5. 用例结束。

### A3. 设置密码保护 
* **触发条件**：在基本流步骤 4，房主将房间设置为“私密/不公开”。
1. 系统要求房主设置入场密码。
2. 房主输入密码。
3. 系统验证密码复杂度（如：需4-6位数字）。
   - *若验证失败，系统提示错误，重复步骤 2。*
4. 系统保存加密后的密码。
5. 流程合并至基本流步骤 6。

### A4. 校验失败
* **触发条件**：在基本流步骤 5，数据不符合业务规则。
1. 系统显示具体的错误原因（如“人数不能小于当前在线人数”）。
2. 流程返回基本流步骤 4，允许房主重新输入。

## 6. 后置条件
- **修改成功**：房间配置或成员权限已更新至服务器。
- **解散成功**：房间对象及相关会话被销毁。
- **操作取消/失败**：房间状态保持操作前原样。



---

# 用例描述：管理成员 

## 1. 简要描述
本用例描述了**房间管理员**（或房主扮演此角色）如何维护房间内的聊天与观影秩序。管理员可以踢出违规用户、限制特定用户的发言权限，或设置全局禁言模式。

## 2. 参与者
- **发起参与者**：房间管理员 
- **受影响对象**：观众

## 3. 前置条件
- 管理员已登录并进入房间。
- 管理员拥有有效的管理权限（未被降级）。

## 4. 基本事件流 
*(场景：管理员踢出一名违规观众)*

1. **用例启动**：管理员在成员列表中选择一名目标观众并请求管理，用例启动。
2. **展示选项**：系统显示对该目标可执行的操作（踢出、禁言）。
3. **选择操作**：管理员选择“踢出用户 (Kick)”。
4. **权限验证**：系统验证目标用户的身份等级。
   - *业务规则：管理员不可踢出房主或其他管理员。*
5. **执行踢出**：
   - 系统强制断开目标观众的连接。
   - 系统将目标观众加入“临时黑名单”（防止立即重连）。
6. **通知全员**：系统在聊天区发布“某用户已被移出房间”的系统消息。
7. **刷新列表**：系统更新房间成员列表，移除该用户。
8. **用例结束**。

## 5. 备选事件流 

### A1. 管理发言权限
* **触发条件**：在基本流步骤 3，管理员选择“禁言/解除禁言”。
1. 管理员设定禁言时长（如：10分钟、永久）。
2. 系统更新该观众的发言状态。
3. 系统向该观众发送通知：“您已被管理员禁言”。
4. 系统刷新成员列表以显示禁言图标。
5. 用例结束。

### A2. 设置全局聊天模式 
* **触发条件**：管理员请求更改房间的整体聊天设置。
1. 管理员选择模式（全员禁言 / 仅管理员发言 / 自由发言）。
2. 系统更新房间的全局状态配置。
3. 系统向所有在线成员广播状态变更通知。
4. 用例结束。

### A3. 权限不足
* **触发条件**：在基本流步骤 4，管理员试图操作房主或其他管理员。
1. 系统拦截操作。
2. 系统向管理员显示错误提示：“权限不足：无法操作同级或上级成员”。
3. 用例结束（失败）。

### A4. 目标用户已离开 
* **触发条件**：在基本流步骤 4，系统检测到目标用户 ID 已不在当前房间列表中。
1. 系统提示“用户已离开房间”。
2. 系统自动刷新成员列表。
3. 用例结束。

### A5. 网络异常处理
* **触发条件**：在与服务器交互的任意步骤发生超时。
1. 系统提示“网络请求超时，请重试”。
2. 系统允许管理员点击重试或取消操作。

## 6. 后置条件
- **踢出**：目标用户与房间断开连接。
- **禁言**：目标用户在指定时间内无法发送消息事件 (Message_Event)。
- **无变更**：若操作失败，成员状态保持不变。
